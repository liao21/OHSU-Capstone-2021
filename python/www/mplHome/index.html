<!DOCTYPE html>
<html>

<head>

    <meta charset="UTF-8">

    <title>MPL Mobile Trainer</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>

    <link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" href="blueimp-gallery/css/blueimp-gallery.css">

    <style type='text/css'>
        html {
            background-color: #333;
        }
        @media only screen and (min-width: 600px) {
            .ui-page {
                width: 480px !important;
                margin: 0 auto !important;
                position: relative !important;
                border-right: 5px #666 outset !important;
                border-left: 5px #666 outset !important;
            }
        }
    </style>

    
    <script src="jquery.mobile/jquery-1.11.1.min.js"></script>
    <script src="jquery.mobile/jquery.mobile-1.4.5.min.js"></script>
    <script src="spacebrew.js/sb-1.4.1.min.js"></script>

    <script>
        // Spacebrew Object
        var sb, app_name = "MPL Control",
            values = {};

        // when page loads call spacebrew setup function 
        $(window).on("load", setupSpacebrew);

        // when the jquery mobile is ready to initialize the UI call the setUI function 
        $(document).bind("pageinit", setupUI);


        /**
         * setupSpacebrew Function that creates and configures the connection to the Spacebrew server.
         * 				  It is called when the page loads.
         */

        function setupSpacebrew() {
            var random_id = "0000" + Math.floor(Math.random() * 10000);

            app_name = app_name + ' ' + random_id.substring(random_id.length - 4);

            console.log("Setting up spacebrew connection");
            sb = new Spacebrew.Client("127.0.0.1");

            sb.name(app_name);
            sb.description("JHU/APL Mobile Training Interface");

            // configure the publication and subscription feeds
            sb.addPublish("trainerString", "string", "");
            sb.addSubscribe("mplString", "string");

            // override Spacebrew events - this is how you catch events coming from Spacebrew
            sb.onStringMessage = onStringMessage;
            sb.onOpen = onOpen;

            // connect to Spacebrew
            sb.connect();
            
            // listen to button clicks
            $("#ID_ADD").on("mousedown", function() {sendCmd("Cmd:Add")} );
            $("#ID_STOP").on("mousedown", function() {sendCmd("Cmd:Stop")} );
            $("#ID_CLEARCLASS").on("mousedown", function() {sendCmd("Cmd:ClearClass")} );
            $("#ID_CLEARALL").on("mousedown", function() {sendCmd("Cmd:ClearAll")} );
            $("#ID_TRAIN").on("mousedown", function() {sendCmd("Cmd:Train")} );
            $("#ID_SAVE").on("mousedown", function() {sendCmd("Cmd:Save")} );
            $("#ID_BACKUP").on("mousedown", function() {sendCmd("Cmd:Backup")} );
            $("#ID_SPEEDUP").on("mousedown", function() {sendCmd("Cmd:SpeedUp")} );
            $("#ID_SPEEDDOWN").on("mousedown", function() {sendCmd("Cmd:SpeedDown")} );
            $("#ID_HAND_SPEED_UP").on("mousedown", function() {sendCmd("Cmd:HandSpeedUp")} );
            $("#ID_HAND_SPEED_DOWN").on("mousedown", function() {sendCmd("Cmd:HandSpeedDown")} );
            $("#ID_PAUSE").on("mousedown", function() {sendCmd("Cmd:Pause")} );
            $("#ID_PAUSE_HAND").on("mousedown", function() {sendCmd("Cmd:PauseHand")} );
            $("#ID_SHUTDOWN").on("mousedown", function() {sendCmd("Cmd:Shutdown")} );
            $("#ID_ASSESSMENT_MT").on("mousedown", function() {sendCmd("Cmd:StartMotionTester")} );
            $("#ID_ASSESSMENT_TAC").on("mousedown", function() {sendCmd("Cmd:StartAssessment")} );
            
        };
        
        // global function called from index and galleryLinks.js
        function sendCmd(cmd) {
            console.log('Send ' + cmd);
            sb.send("trainerString", "string", cmd);
        };

        // Function that is called when Spacebrew connection is established
        function onOpen() {
            console.log('Spacebrew Connected');
            var message = "Connected as <strong>" + sb.name() + "</strong>";
            if (sb.name() === app_name) {
                message += "<br>You can customize this app's name in the query string by adding <strong>name=your_app_name</strong>."
            }
            $("#statusMsg").html(message);
        }


        /**
         * onStringMessage Function that is called whenever new spacebrew string messages are received.
         *          It accepts two parameters:
         * @param  {String} name    Holds name of the subscription feed channel
         * @param  {String} value 	Holds value received from the subscription feed
         */
         function onStringMessage( name, value ){
             console.log("[onStringMessage] string message received ", value);
			 var parts = value.split(':');
			 var cmd_type = parts[0];
			 var cmd_data = parts[1];
			 
             if (name == "mplString") {
				 if (cmd_type == "strStatus") {
					 $("#msg_status").text(cmd_data);
				 }         
				 if (cmd_type == "strTrainingMotion") {
					 $("#msg_train").text(cmd_data);
				 }         
				 if (cmd_type == "strOutputMotion") {
					 $("#msg_output").text(cmd_data);
				 }
                 if (cmd_type == "strAssessmentStatus") {
					 $("#assessment_status").text(cmd_data);
				 }
			 }
         }

    </script>

</head>



<body>

    <div data-role="page">
        <div data-role="header" data-theme="b" >
            <h1>MPL Mobile Trainer</h1>
        </div>
        <!-- <div data-role="content">	 -->

        <div data-role="collapsible" data-collapsed-icon="gear" data-expanded-icon="gear">
        <h4>Configure</h4>
        <ul data-role="listview" data-inset="false">
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-plus" id="ID_SPEEDUP">Increase Arm Speed</a></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-minus" id="ID_SPEEDDOWN">Decrease Arm Speed</a></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-plus" id="ID_HAND_SPEED_UP">Increase Hand Speed</a></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-minus" id="ID_HAND_SPEED_DOWN">Decrease Hand Speed</a></li>
        </ul>
        </div>
        
        <div data-role="collapsible" data-collapsed-icon="bullets" data-expanded-icon="bullets">
        <h4>Options</h4>
        <ul data-role="listview" data-inset="false">
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-forbidden" id="ID_PAUSE">Pause All Motion</a></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-forbidden" id="ID_PAUSE_HAND">Pause Hand</a></li>
        <li></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-star" id="ID_ASSESSMENT_TAC">Start TAC Assessment</a></li>
        <li><a href="#" class="ui-btn ui-btn-icon-right ui-icon-star" id="ID_ASSESSMENT_MT">Start Motion Test</a></li>                
        <li>Assesment Status: <p = id="assessment_status"/></li>
        <li></li>
        <li><a href="#popupDialog" data-rel="popup" data-position-to="window" data-role="button" data-inline="true" data-transition="pop" data-icon="power" data-theme="a" data-iconpos="right">Shutdown MPL</a></li>
        </ul>
        </div>

        <div data-role="popup" id="popupDialog" data-overlay-theme="a" data-theme="b" data-dismissible="false" style="max-width:400px;" class="ui-corner-all">
        <div data-role="header" data-theme="a" class="ui-corner-top">
        <h1>Confirm Shutdown</h1>
        </div>
        <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
        <h3 class="ui-title">Are you sure you want to shutdown?</h3>
        <a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="c">Cancel</a>
        <a href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b" id="ID_SHUTDOWN">OK</a>
        </div>
        </div>
        
        <p>Selected Motion: <span = id="msg_train"/></p>
        <div id="blueimp-image-carousel" class="blueimp-gallery blueimp-gallery-controls blueimp-gallery-carousel">
            <div class="slides"></div>
            <h3 class="title"></h3>
            <a class="prev">‹</a>
            <a class="next">›</a>
        </div>

        <div data-role="controlgroup" data-type="horizontal">
            <a href="#" class="ui-btn" id="ID_ADD">Add</a>
            <a href="#" class="ui-btn" id="ID_STOP">Stop</a>
            <a href="#" class="ui-btn" id="ID_CLEARCLASS">Clear</a>
            <a href="#" class="ui-btn" id="ID_CLEARALL">Reset</a>
            <a href="#" class="ui-btn" id="ID_SAVE">Save</a>
            <!-- <a href="#" class="ui-btn" id="ID_TRAIN">Train</a> -->
        </div>

        <script src="blueimp-gallery/js/blueimp-helper.js"></script>
        <script src="blueimp-gallery/js/blueimp-gallery.js"></script>
        <script src="blueimp-gallery/js/blueimp-gallery-fullscreen.js"></script>
        <script src="blueimp-gallery/js/blueimp-gallery-indicator.js"></script>
        <script src="blueimp-gallery/js/vendor/jquery.js"></script>
        <script src="blueimp-gallery/js/jquery.blueimp-gallery.js"></script>
        <script src="gallery-links.js"></script>

        <p>Classifying: <span = id="msg_output"/></p>
        <p>Status: <span = id="msg_status"/></p>
        <p>Server: <span = id="statusMsg"/></p>

        <!-- </div><!-- /content -->
    </div>
    <!-- /page -->

</body>

</html>
